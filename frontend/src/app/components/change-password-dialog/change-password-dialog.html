@if (open) {
  <div class="change-password-overlay">
    <div class="change-password-dialog" role="dialog" aria-modal="true" aria-labelledby="change-password-title">
      <h3 id="change-password-title">Cambiar contraseña</h3>

      <form [formGroup]="form" (ngSubmit)="submit()" class="change-password-form">
        <div class="change-password-field">
          <label for="currentPassword">Contraseña actual</label>
          <input id="currentPassword" type="password" formControlName="currentPassword" />
          @if (form.get('currentPassword')?.touched && form.get('currentPassword')?.hasError('required')) {
            <small class="change-password-error">Requerida</small>
          }
        </div>

        <div class="change-password-field">
          <label for="newPassword">Nueva contraseña</label>
          <input id="newPassword" type="password" formControlName="newPassword" />
          @if (form.get('newPassword')?.touched && form.get('newPassword')?.hasError('required')) {
            <small class="change-password-error">Requerida</small>
          }
        </div>

        <div class="change-password-field">
          <label for="confirmPassword">Confirmar nueva contraseña</label>
          <input id="confirmPassword" type="password" formControlName="confirmPassword" />
          @if (form.touched && form.hasError('passwordsNotMatch')) {
            <small class="change-password-error">Las contraseñas no coinciden</small>
          }
        </div>

        <div class="change-password-actions">
          <button type="button" class="change-password-button change-password-button-secondary" (click)="close()" [disabled]="submitting">Cancelar</button>
          <button type="submit" class="change-password-button change-password-button-primary" [disabled]="submitting || form.invalid">
            @if (!submitting) {
              <span>Confirmar</span>
            }
            @if (submitting) {
              <span class="change-password-loading">Guardando...</span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
}

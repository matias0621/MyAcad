<section class="crud-management d-flex justify-content-center">
    <div class="crud-management-container">
        <h1 style="text-align: center;">{{capitalizeFirst(programName)}}</h1>

        <div id="subjects">
            <button class="subjects-state-btn" data-bs-toggle="modal" data-bs-target="#modal-subjects">Estado de
                materias</button>
        </div>
        <div id="subjects">
            <button class="subjects-state-btn" data-bs-toggle="modal" data-bs-target="#modal-subjects-plan">Materias del
                plan</button>
        </div>

        <table class="crud-table">
            <thead>
                <tr class="text-center">
                    <th scope="col">Comisión</th>
                    <th scope="col">Materias</th>
                </tr>
            </thead>
            <tbody class="crud-table-body">
                <!-- USERS -->
                @for (subXStu of listSubjects; track $index) {
                <tr class="crud-table-item">
                    <td>{{subXStu.commission.number}}</td>
                    <td class="subject-cell">
                        <span class="subject-name">{{ subXStu.subjects.name }}</span>
                        <div class="subject-actions">
                            @if(showEvaluation && !hasEvaluated(subXStu.subjects.id, subXStu.commission.id)){
                                <button class="subjects-state-btn evaluation-btn" data-bs-toggle="modal"
                                    data-bs-target="#modal-course-evaluetion" (click)="setDataForEvaluetion(subXStu.commission,subXStu.subjects)" >Realizar encuesta</button>
                            }
                            @if(showEvaluation && hasEvaluated(subXStu.subjects.id, subXStu.commission.id)){
                                <span class="evaluation-done">Encuesta realizada</span>
                            }
                        </div>
                    </td>

                </tr>
                }@empty {
                <tr>
                    <td colspan="6" class="text-center">
                        <p style="color: red;"> Aun no hay ninguna comisión cargada.</p>
                    </td>
                </tr>
                }
            </tbody>
            <tfoot>
            </tfoot>
        </table>

        <h1 style="text-align: center;">Examenes</h1>
        <!-- TABLA -->
        <table class="crud-table">
            <thead>
                <tr class="text-center">
                    <th scope="col">Nota</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Materia</th>
                    <th scope="col">Tipo de examen</th>
                </tr>
            </thead>
            <tbody class="crud-table-body">
                <!-- USERS -->
                @for (exams of listExams; track $index) {
                <tr class="crud-table-item">
                    <td>{{exams.score}}</td>
                    <td>{{exams.student.name}}</td>
                    <td>{{exams.subject.name}}</td>

                    @if(exams.examType === "EXAM"){
                    <td>Parcial</td>
                    }
                    @else if (exams.examType === "FINAL_EXAM") {
                    <td>Final</td>
                    }
                    @else if (exams.examType === "MAKEUP_EXAM") {
                    <td>Recuperatorio</td>
                    }
                </tr>
                }@empty {
                <tr>
                    <td colspan="6" class="text-center">
                        <p style="color: red;"> Aun no hay ningun examen cargado.</p>
                    </td>
                </tr>
                }
            </tbody>
            <tfoot>
            </tfoot>
        </table>
    </div>
</section>

<!-- Modal estado de materias -->
<div class="modal fade crud-modal" id="modal-subjects" tabindex="-1" aria-labelledby="modal-subjects-label"
    style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered crud-modal__dialog">
        <div class="modal-content crud-modal__content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 titles">Estado de materias</h1>
                <button data-bs-dismiss="modal" aria-label="Close">
                    <i class="fa-solid fa-x"></i>
                </button>
            </div>
            <div class="modal-body crud-modal__body">
                <div class="subjects-status-container">
                    @for (subjects of listSubjects; track $index) {
                    <div class="subject-status-card">
                        <div class="subject-status-header">
                            <h3 class="subject-name-title">{{subjects.subjects.name}}</h3>
                            @if (subjects.stateStudent == 'FAILED') {
                                <span class="status-badge status-failed">Recursa</span>
                            } @else if (subjects.stateStudent == 'INPROGRESS') {
                                <span class="status-badge status-inprogress">Cursando</span>
                            } @else if (subjects.stateStudent == 'COMPLETED') {
                                <span class="status-badge status-completed">Promocion</span>
                            } @else if (subjects.stateStudent == 'APPROVED') {
                                <span class="status-badge status-approved">Aprobada</span>
                            }
                        </div>
                    </div>
                    }@empty {
                    <div class="detail-item">
                        <strong style="color: red;">Aún no estás inscripto/a a ninguna materia.</strong>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal materias del plan -->
<div class="modal fade crud-modal" id="modal-subjects-plan" tabindex="-1" aria-labelledby="modal-subjects-plan-label"
    style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered crud-modal__dialog">
        <div class="modal-content crud-modal__content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 titles">Materias del plan</h1>
                <button data-bs-dismiss="modal" aria-label="Close">
                    <i class="fa-solid fa-x"></i>
                </button>
            </div>
            <div class="modal-body crud-modal__body">
                <div class="subjects-plan-container">
                    @for (subjects of listSubjects; track $index) {
                    <div class="subject-plan-card">
                        <div class="subject-plan-header">
                            <h3 class="subject-name-title">{{subjects.subjects.name}}</h3>
                        </div>
                        <div class="subject-plan-body">
                            <div class="plan-detail-row">
                                <span class="plan-label">Correlativas:</span>
                                <span class="plan-value">{{subjects.subjects.prerequisites || 'Ninguna'}}</span>
                            </div>
                        </div>
                    </div>
                    }@empty {
                    <div class="detail-item">
                        <strong style="color: red;">Este programa no tiene materias asignadas.</strong>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de encuesta de la materia -->
<div class="modal fade crud-modal" id="modal-course-evaluetion" tabindex="-1"
    aria-labelledby="modal-subjects-plan-label" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered crud-modal__dialog">
        <div class="modal-content crud-modal__content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 titles">
                    @if (teacher) {
                        Encuesta de materia - {{ teacher.name }} {{ teacher.lastName }}
                    } @else {
                        Encuesta de materia
                    }
                </h1>
                <button data-bs-dismiss="modal" aria-label="Close">
                    <i class="fa-solid fa-x"></i>
                </button>
            </div>
            <div class="modal-body crud-modal__body">
                <div class="evaluation-form-container">
                    <form [formGroup]="formReview" (submit)="createCourseEvaluetion()">
                        <div class="form-group-evaluation">
                            <label for="teacherFeedback">¿Qué te pareció el docente?</label>
                            <textarea id="teacherFeedback" formControlName="teacherFeedback" placeholder="Escribe tu opinión sobre el docente..." rows="3"></textarea>
                        </div>
                        <div class="form-group-evaluation">
                            <label for="contentFeedback">¿Qué te parecieron los contenidos?</label>
                            <textarea id="contentFeedback" formControlName="contentFeedback" placeholder="Escribe tu opinión sobre los contenidos..." rows="3"></textarea>
                        </div>
                        <div class="form-group-evaluation">
                            <label for="suggestion">Sugerencias para el docente</label>
                            <textarea id="suggestion" formControlName="suggestion" placeholder="Escribe tus sugerencias..." rows="3"></textarea>
                        </div>
                        <div class="form-actions-evaluation">
                            <button type="button" class="btn-cancel" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="subjects-state-btn" [disabled]="formReview.invalid" data-bs-dismiss="modal">Enviar encuesta</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>